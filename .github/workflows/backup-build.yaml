name: vw-backup-build
permissions:
  contents: read
on:
  push:
    tags:
      - "vw-backup-*"
  schedule:
    - cron: "37 10 * * 6"
  workflow_dispatch:

jobs:
  get-tag:
    uses: theadzik/homelab/.github/workflows/get-tag.yaml@main
    with:
      tag-prefix: "vw-backup-"
  build-push:
    uses: theadzik/homelab/.github/workflows/build-push.yaml@main
    needs: get-tag
    with:
      source-tag: ${{ needs.get-tag.outputs.git_tag }}
      docker-tag: ${{ needs.get-tag.outputs.docker_tag }}
      docker-repo: vw-backup
      context-path: apps/vaultwarden/backup
      docker-push: true
    secrets: inherit
